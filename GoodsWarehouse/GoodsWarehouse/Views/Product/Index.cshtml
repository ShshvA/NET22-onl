@using System.ComponentModel.DataAnnotations
@{
    ViewData["Title"] = "Home Page";
}

@model GoodsWarehouse.VM.ProductsVM

@{
    bool isData = false;
}
<div class="w-100 mb-3">
    @if (Model.ProductsList.Any())
    {
        isData = true;
        <h3>Список продуктов</h3>

        <table class="table">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Название</th>
                    <th scope="col">Тип продукта</th>
                    <th scope="col">Цена, $</th>
                    <th scope="col">Количество товаров</th>
                    <th scope="col"></th>
                    <th scope="col"></th>
                </tr>
            </thead>
            <tbody>
                @for (int i = 0; i < Model.ProductsList.Count; i++)
                {
                    var product = Model.ProductsList[i];
                    <tr>
                        <th scope="row">@(i + 1)</th>
                        <td>@product.Name</td>

                        @switch (product.Type)
                        {
                            case ProductType.Fruits:
                                <td>Фрукты</td>
                                break;
                            case ProductType.Vegetables:
                                <td>Овощи</td>
                                break;
                            case ProductType.Berries:
                                <td>Ягоды</td>
                                break;
                            default:
                                <td>-</td>
                                break;
                        }

                        <td>@product.Price</td>
                        <td>@product.NumberOfProducts</td>

                        <td>
                            <div class="dropdown" style="min-width: 400px;">
                                <button type="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" data-bs-auto-close="outside">
                                    Редактировать
                                </button>
                                <form class="dropdown-menu p-3 flex-column" method="post" asp-controller="Product" asp-action="UpdateProduct">
                                    <input type="hidden" name="Id" value="@product.Id">
                                    <div class="d-flex mb-3 gap-2 align-items-center">
                                        <label class="form-label mb-0" style="min-width: 130px;">Название товара</label>
                                        <input type="text" class="form-control" name="Name" value="@product.Name">
                                    </div>
                                    <div class="d-flex mb-3 gap-2 align-items-center">
                                        <label class="form-label mb-0" style="min-width: 130px;">Тип товара</label>
                                        <select class="form-select" name="Type">
                                            @foreach (var type in Model.ProductTypesList)
                                            {
                                                @switch (type)
                                                {
                                                    case ProductType.Fruits:
                                                        @if (product.Type == ProductType.Fruits)
                                                        {
                                                            <option value="1" selected>Фрукты</option>
                                                        }
                                                        else
                                                        {
                                                            <option value="1">Фрукты</option>
                                                        }
                                                        break;
                                                    case ProductType.Vegetables:
                                                        @if (product.Type == ProductType.Vegetables)
                                                        {
                                                            <option value="2" selected>Овощи</option>
                                                        }
                                                        else
                                                        {
                                                            <option value="2">Овощи</option>
                                                        }
                                                        break;
                                                    case ProductType.Berries:
                                                        @if (product.Type == ProductType.Berries)
                                                        {
                                                            <option value="3" selected>Ягоды</option>
                                                        }
                                                        else
                                                        {
                                                            <option value="3">Ягоды</option>
                                                        }
                                                        break;
                                                    default:
                                                        @if (product.Type == ProductType.None)
                                                        {
                                                            <option selected disabled>Выберите тип...</option>
                                                        }
                                                        else
                                                        {
                                                            <option disabled>Выберите тип...</option>
                                                        }
                                                        break;
                                                }
                                            }
                                        </select>
                                    </div>
                                    <div class="d-flex mb-3 gap-2 align-items-center">
                                        <label class="form-label mb-0" style="min-width: 130px;">Стоимость единицы товара</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" name="Price" value="@product.Price">
                                            <span class="input-group-text">$</span>
                                        </div>
                                    </div>
                                    <div class="d-flex mb-3 gap-2 align-items-center">
                                        <label class="form-label mb-0" style="min-width: 130px;">Количество товара</label>
                                        <input type="number" class="form-control" name="NumberOfProducts" value="@product.NumberOfProducts">
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100">Сохранить</button>
                                </form>
                            </div>
                        </td>
                        <td>
                            <form method="post" asp-controller="Product" asp-action="DeleteProduct" asp-route-idProduct="@product.Id">
                                <button type="submit" class="btn btn-outline-primary">
                                    Удалить
                                </button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
</div>

<div class="d-flex">
    <div class="dropdown mb-3 w-100">
        <button type="button" class="btn btn-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" data-bs-auto-close="outside">
            Добавить продукт
        </button>
        <form class="dropdown-menu p-3 flex-column" method="post" asp-controller="Product" asp-action="AddProduct">
            <div class="d-flex mb-3 gap-2 align-items-center">
                <label class="form-label mb-0" style="min-width: 130px;">Название товара</label>
                <input type="text" class="form-control" name="Name">
            </div>
            <div class="d-flex mb-3 gap-2 align-items-center">
                <label class="form-label mb-0" style="min-width: 130px;">Тип товара</label>
                <select class="form-select" name="Type">
                    @foreach (var type in Model.ProductTypesList)
                    {
                        @switch (type)
                        {
                            case ProductType.Fruits:
                                <option value="1">Фрукты</option>
                                break;
                            case ProductType.Vegetables:
                                <option value="2">Овощи</option>
                                break;
                            case ProductType.Berries:
                                <option value="3">Ягоды</option>
                                break;
                            default:
                                <option disabled>Выберите тип...</option>
                                break;
                        }
                    }
                </select>
            </div>
            <div class="d-flex mb-3 gap-2 align-items-center">
                <label class="form-label mb-0" style="min-width: 130px;">Стоимость единицы товара</label>
                <div class="input-group">
                    <input type="text" class="form-control" name="Price">
                    <span class="input-group-text">$</span>
                </div>
            </div>
            <div class="d-flex mb-3 gap-2 align-items-center">
                <label class="form-label mb-0" style="min-width: 130px;">Количество товара</label>
                <input type="number" class="form-control" name="NumberOfProducts">
            </div>
            <button type="submit" class="btn btn-primary w-100">Сохранить</button>
        </form>
    </div>

    @if (isData)
    {
        <div class="mb-3">
            <form method="post" asp-controller="ProductReport" asp-action="ShowReport">
                <button type="submit" class="btn btn-outline-primary">
                    Отчет
                </button>
            </form>
        </div>
    }
</div>

<div class="w-100 mb-3">
    @if (Model.Report.Any())
    {
        <h3>Отчет</h3>

        <table class="table">
            <thead>
                <tr>
                    <th scope="col">Тип продукта</th>
                    <th scope="col">Сумма, $</th>
                    <th scope="col">Итог, $</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var (key, value) in Model.Report)
                {
                    if (key == -1)
                    {
                        continue;
                    }

                    var type = (ProductType)key;                       
                    <tr>                            
                        @switch (type)
                        {
                            case ProductType.Fruits:
                                <td>Фрукты</td>
                                break;
                            case ProductType.Vegetables:
                                <td>Овощи</td>
                                break;
                            case ProductType.Berries:
                                <td>Ягоды</td>
                                break;
                            default:
                                <td>None</td>
                                break;
                        }

                        <td>@value</td>
                    </tr>
                }
                <tr>
                    <td>Итог</td>
                    <td></td>
                    <td>@Model.Report[-1]</td>
                </tr>
            </tbody>
        </table>
    }
</div>






